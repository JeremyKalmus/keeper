# Backend Seed Registry
# Machine-readable registry of approved API routes and services
# Keeper uses this to enforce REST consistency and service boundaries

api_routes:
  # Dashboard API routes - discovered by keeper-plant

  GET /api/health:  # discovered
    purpose: "Health check endpoint"
    auth_required: false
    returns: "{ status: 'ok', timestamp: ISO8601 }"

  GET /api/vaults:  # discovered
    purpose: "List all available seed vaults"
    auth_required: false
    returns: "{ vaults: [{ name, file }] }"

  GET /api/vault/:name:  # discovered
    purpose: "Get specific vault content parsed from YAML"
    auth_required: false
    returns: "{ name, content }"

  GET /api/decisions:  # discovered
    purpose: "List all decisions with summaries"
    auth_required: false
    returns: "{ decisions: [{ id, file, summary }] }"

  GET /api/decision/:id:  # discovered
    purpose: "Get specific decision content parsed from YAML"
    auth_required: false
    returns: "{ id, content }"

  GET /api/events:  # discovered
    purpose: "Server-Sent Events endpoint for real-time updates"
    auth_required: false
    content_type: "text/event-stream"
    events:
      - connected: "Initial connection confirmation"
      - vault-updated: "{ file } when seed vault YAML changes"
      - decision-updated: "{ file } when decision YAML changes"

services:
  YAMLParsingService:  # discovered
    responsibilities:
      - parse YAML files to JavaScript objects
      - list YAML files in directory
      - handle parse errors gracefully
    forbidden:
      - caching parsed content (always fresh read)
      - modifying YAML files

  FileWatcherService:  # discovered
    responsibilities:
      - watch seeds/ directory for changes
      - watch decisions/ directory for changes
      - broadcast SSE events on file changes
    forbidden:
      - watching non-YAML files
      - recursive directory watching

  SSEBroadcastService:  # discovered
    responsibilities:
      - manage connected SSE clients
      - broadcast events to all clients
      - cleanup disconnected clients
    forbidden:
      - client-specific messages (broadcast only)
      - message persistence

cors:  # discovered
  allowed_origins: ["*"]
  allowed_methods: ["GET", "OPTIONS"]
  allowed_headers: ["Content-Type"]
  notes: "Permissive for local dev - restrict in production"
